{% extends "layout.html" %}
{% block content %}

<h2>Your Habits</h2>

<div class="card">
<form action="/add_habit" method="post">
    <input name="name" placeholder="Habit name" required>
    <input name="category" placeholder="Category">
    <input name="difficulty" type="number" min="1" max="5" placeholder="Difficulty">
    <button type="submit">Add Habit</button>
</form>
</div>

{% for habit in habits %}
<div class="card">
    <h3>{{ habit.name }}</h3>
    <p>Category: {{ habit.category }}</p>
    <p>Difficulty: {{ habit.difficulty }}</p>
    <p>Streak: {{ habit.streak }} days</p>
    <p>Completion Rate: {{ habit.completion_rate }}%</p>

    {% if habit.risk %}
        <p style="color:red;">âš  Habit at Risk!</p>
    {% endif %}

    <a href="/complete/{{ habit.id }}">Complete Today</a> |
    <a href="/delete/{{ habit.id }}">Delete</a>

    <canvas id="chart-{{ habit.id }}"></canvas>

    <script>
        new Chart(
            document.getElementById("chart-{{ habit.id }}"),
            {
                type: "bar",
                data: {
                    labels: ['6d','5d','4d','3d','2d','1d','Today'],
                    datasets: [{
                        label: "Completed",
                        data: {{ habit.weekly_data | tojson }}
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, max: 1 }
                    }
                }
            }
        );
    </script>
</div>
{% endfor %}

{% endblock %}